Project Zenith: 初始化指令文档 (Initialization Directive)

项目代号: Zenith
目标: 构建一个基于 Monorepo 的、多技术栈（React, Vue, Svelte）的微前端应用架构。该架构以前后端类型安全为核心，采用现代化、高性能的技术栈，并包含一个跨框架共享的 Web Components 组件库。

Phase 1: 环境与基础设置

Agent Note: 此阶段确保开发环境满足基本要求，并初始化项目根目录。

环境要求确认:

Node.js >= v18.0.0

pnpm >= v8.0.0

初始化 Monorepo:
使用 Turborepo 脚手架创建项目。它将自动配置 pnpm workspaces。

code
Sh
download
content_copy
expand_less
# 在你的开发目录下执行
npx create-turbo@latest zenith

在交互式提示中，选择 pnpm 作为包管理器。

进入项目并清理模板:
Turborepo 会生成一些模板文件，我们将清理它们以便从零开始构建。

code
Sh
download
content_copy
expand_less
cd zenith
# 删除默认的应用和包
rm -rf apps/*
rm -rf packages/*
# 创建新的空目录
mkdir -p apps
mkdir -p packages
# 清理根 package.json 的 scripts
# (Agent: 可通过脚本解析JSON并移除所有scripts)
Phase 2: 核心共享包 (Packages) 创建

Agent Note: 此阶段构建项目的核心基础，这些包将被多个应用共享。

共享 TypeScript 配置 (packages/tsconfig):

code
Sh
download
content_copy
expand_less
mkdir -p packages/tsconfig
cd packages/tsconfig

pnpm init

# 创建 tsconfig.base.json 文件
cat <<EOF > tsconfig.base.json
{
  "compilerOptions": {
    "target": "ESNext",
    "module": "ESNext",
    "moduleResolution": "bundler",
    "lib": ["ESNext", "DOM", "DOM.Iterable"],
    "strict": true,
    "esModuleInterop": true,
    "skipLibCheck": true,
    "noUnusedLocals": true,
    "noUnusedParameters": true,
    "noFallthroughCasesInSwitch": true,
    "resolveJsonModule": true,
    "isolatedModules": true
  },
  "exclude": ["node_modules"]
}
EOF

# 创建 package.json，声明此包为 workspace 的一部分
# (Agent: 确保 package.json 的 name 是 "@zenith/tsconfig")
cd ../..

共享 UI 组件库 (packages/ui): (Lit + Tailwind CSS)

code
Sh
download
content_copy
expand_less
cd packages
# 使用 Vite 初始化 Lit + TS 模板
pnpm create vite ui --template lit-ts
cd ui

# 安装 Tailwind CSS 依赖
pnpm add -D tailwindcss postcss autoprefixer

# 初始化 Tailwind CSS 配置文件
npx tailwindcss init -p

# 配置 tailwind.config.js (扫描 Lit 组件)
# (Agent: 脚本化文件写入)
# content: ['./index.html', './src/**/*.{ts,js}']

# 配置 Vite 以支持模块联邦和样式注入 (关键步骤)
pnpm add -D @originjs/vite-plugin-federation
# (Agent: 后续需在 vite.config.ts 中配置)

cd ../..

tRPC API 路由定义 (packages/api):

code
Sh
download
content_copy
expand_less
mkdir -p packages/api
cd packages/api

pnpm init
pnpm add @trpc/server zod
pnpm add -D typescript @types/node

# 创建初始 tRPC 路由文件 src/router.ts
mkdir src
# (Agent: 写入 Phase 3 中定义的 tRPC 路由模板)
# (Agent: 确保 package.json 的 name 是 "@zenith/api")

cd ../..

Drizzle ORM & 数据库 Schema (packages/db):

code
Sh
download
content_copy
expand_less
mkdir -p packages/db
cd packages/db

pnpm init
pnpm add drizzle-orm pg # pg 是 PostgreSQL 驱动
pnpm add -D drizzle-kit typescript dotenv

# 创建 schema 定义文件 src/schema.ts
mkdir src
# (Agent: 写入空的 schema 模板)

# 创建 drizzle.config.ts
# (Agent: 写入 Drizzle 配置模板，指向 schema 文件和 .env)

# (Agent: 确保 package.json 的 name 是 "@zenith/db")

cd ../..
Phase 3: 应用程序 (Apps) 脚手架

Agent Note: 此阶段创建所有独立的应用，包括后端和前端微应用。

Hono 后端服务 (apps/backend):

code
Sh
download
content_copy
expand_less
mkdir -p apps/backend
cd apps/backend

pnpm init
pnpm add hono @hono/trpc-server @zenith/api @zenith/db # 依赖共享包
pnpm add -D typescript @types/node tsx # tsx 用于开发时运行

# 创建主入口文件 src/index.ts
mkdir src
# (Agent: 写入 Hono + tRPC 服务器启动模板)

cd ../..

React 子应用 (apps/react-app):

code
Sh
download
content_copy
expand_less
cd apps
pnpm create vite react-app --template react-ts
cd react-app

# 添加 tRPC client 和 React Query
pnpm add @trpc/client @trpc/server @trpc/react-query @tanstack/react-query
# 添加模块联邦插件
pnpm add -D @originjs/vite-plugin-federation
# 添加 Tailwind CSS
pnpm add -D tailwindcss postcss autoprefixer && npx tailwindcss init -p

cd ../..

Vue 子应用 (apps/vue-app):

code
Sh
download
content_copy
expand_less
cd apps
pnpm create vite vue-app --template vue-ts
cd vue-app

# 添加 tRPC client 和 Vue Query
pnpm add @trpc/client @trpc/server @tanstack/vue-query
pnpm add -D @originjs/vite-plugin-federation
pnpm add -D tailwindcss postcss autoprefixer && npx tailwindcss init -p

cd ../..

Svelte 子应用 (apps/svelte-app):

code
Sh
download
content_copy
expand_less
cd apps
pnpm create vite svelte-app --template svelte-ts
cd svelte-app

# 添加 tRPC client 和 Svelte Query
pnpm add @trpc/client @trpc/server @tanstack/svelte-query
pnpm add -D @originjs/vite-plugin-federation
pnpm add -D tailwindcss postcss autoprefixer && npx tailwindcss init -p

cd ../..
Phase 4: 根目录工具与代码质量

Agent Note: 在 Monorepo 根目录配置开发工具和质量保障体系。

安装依赖:
-w 标志表示安装到 workspace 的根目录。

code
Sh
download
content_copy
expand_less
# 测试框架
pnpm add -D -w vitest playwright

# 代码质量
pnpm add -D -w eslint prettier eslint-config-prettier eslint-plugin-prettier @typescript-eslint/parser @typescript-eslint/eslint-plugin

# Git Hooks
pnpm add -D -w husky lint-staged

配置工具:

code
Sh
download
content_copy
expand_less
# 初始化 Husky
npx husky init
# 创建 pre-commit hook 来运行 lint-staged
echo "pnpm lint-staged" > .husky/pre-commit

# 创建 .eslintrc.cjs, .prettierrc, .prettierignore
# (Agent: 写入推荐的配置文件模板)

# 配置 lint-staged (在根 package.json 中)
# "lint-staged": { "*.{ts,tsx,js,jsx}": "eslint --fix" }

配置 Turborepo (turbo.json):

code
Sh
download
content_copy
expand_less
# (Agent: 写入 turbo.json 配置文件)
# 定义 dev, build, lint, test 等任务的依赖关系和缓存策略
# 例如，"build" 任务依赖于所有它依赖的包的 "build" 任务
Phase 5: CI/CD 流水线

Agent Note: 创建 GitHub Actions 工作流以实现自动化。

创建工作流文件:

code
Sh
download
content_copy
expand_less
mkdir -p .github/workflows
# 创建 ci.yml 文件
cat <<EOF > .github/workflows/ci.yml
name: CI
on: [push, pull_request]
jobs:
  build_and_test:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v3
      - uses: pnpm/action-setup@v2
        with:
          version: 8
      - uses: actions/setup-node@v3
        with:
          node-version: 18
          cache: 'pnpm'
      - run: pnpm install
      - name: Lint
        run: pnpm turbo run lint
      - name: Build
        run: pnpm turbo run build
      - name: Test
        run: pnpm turbo run test
EOF
Phase 6: Finalization

Agent Note: 所有文件和依赖已就位，执行最后的安装和验证。

安装所有依赖:
在项目根目录执行，pnpm 会自动链接所有 workspaces。

code
Sh
download
content_copy
expand_less
pnpm install

验证构建:
执行 Turborepo 的 build 命令，验证所有配置是否正确。

code
Sh
download
content_copy
expand_less
pnpm turbo run build

初始化指令结束。 Project Zenith 的骨架已搭建完成，所有模块已就位，等待进一步的编码实现。
